{% extends "open_base.html" %}
{% block titlecontainer %}
  <div class="w3-10"></div>
  <div class="w3-80">
{% endblock %}

{% block titleheader %}{{ lopsinfo }}{% endblock %}
{% block headercontainer %}{{ lopsinfo }} <img id=header_icon src="../static/icon_settings.png"> {% endblock %}
{% block refresh %}{% endblock %}
{% block titlemain %} <img id=menu_icon src="../static/icon_settings.png"> {{ lopsinfo }}{% endblock %}
{% block content %}
  <table>
    <tr id=subheader id=black>
      <td id=black>Arbeidsflyt - før rennet</td>
      <td width=150>Status</td>
      <td>Funksjoner</td>
      <td></td>
    </tr>
    <tr>
      <td>1. Arrangement: Opprett (<a href=/events?event_id={{ event_id }}>se/endre</a>)</td>
      <td id=green>Utført</td>
      <td></td>
      <td>Tid: {{ event.date_of_event }} kl. {{ event.time_of_event }}<br>Arrangør: {{ event.organiser }} <a href=http://{{ event.webpage }}>Mer info</a></td>
    </tr>
    <tr>
      <td colspan=4 id=spacer></td>
    </tr>
    <tr>
      <td>
        2. Deltakere: Last inn (<a href=/contestants?event_id={{ event_id }}>se/endre</a>)
      </td>
      {% if (task_status.done_2) %}
        <td id=green>Utført</td>
        <td>
          {% if (task_status.done_8) %}
            <form action=/contestants method=get>
              <input type="hidden" name="event_id" value="{{ event_id }}">
              <input type="hidden" name="action" value="new_manual">
              <input type="submit" name="new_manual" value="  Etteranmelding  ">
            </form>
            <div id=minispacer></div>
            <form onclick="event_gui_action('myAvmeld', 'start_edit')" id="myAvmeld" action=/start_edit method=get>
              <input type="hidden" name="event_id" value="{{ event_id }}">
              <input type="hidden" name="action" value="edit_mode">
              <input type="submit" name="remove_start" value="  Melde av (fjerne fra startliste) ">
            </form>
          {% endif %}
        </td>
        <td>{{ task_status.no_of_contestants}} deltakere.</td>
      {% else %}
        <td id=red>Mangler</td>
        <td>
            <form action=/contestants method=get>
              <input type="hidden" name=event_id value="{{ event_id }}">
              <input type="hidden" name=action value="new_from_file">
              <input type="submit" name=new_from_file value="  Last inn deltakere fra fil  ">
            </form>
        </td>
        <td></td>
      {% endif %}
    </tr>
    <tr>
      <td colspan=4 id=spacer></td>
    </tr>
    <tr>
      <td>3a. Klasser: Opprett (<a href=/raceclasses?event_id={{ event_id }}>se/endre</a>)</td>
      {% if (task_status.done_3) %}
        <td id=green>Utført</td>
        <td>
          {% if not task_status.done_6 %}
            <form action=/raceclasses method=get>
              <input type="hidden" name="event_id" value="{{ event_id }}">
              <input type="hidden" name=action value="merge_ageclasses">
              <input type="submit" name="merge_ageclasses" value="  Slå sammen klasser  ">
            </form>
          {% endif %}
        </td>
        <td>{{ task_status.no_of_raceclasses}} klasser.</td>
      {% else %}
        <td id=red>Mangler</td>
        <td>
          {% if (task_status.done_2) %}
            <form action=/raceclasses method=post>
              <input type="hidden" name="event_id" value="{{ event_id }}">
              <input type="submit" name="generate_raceclasses" value="  Generer klasser  ">
            </form>
          {% endif %}
        </td>
        <td></td>
      {% endif %}
    </tr>
    <tr>
      <td colspan=4 id=spacer></td>
    </tr>
    <tr>
      <td>3b. Klasser: Startrekkefølge</td>
      {% if (task_status.done_4) %}
        <td id=green>Utført</td>
        <td></td>
        <td></td>
      {% else %}
        <td id=red>Mangler</td>
        <td>
          {% if (task_status.done_3) %}
            <form action=/raceclasses method=get>
              <input type="hidden" name="event_id" value="{{ event_id }}">
              <input type="hidden" name=action value="update_order">
              <input type="submit" name="generate_raceclasses" value="  Rediger startrekkefølge  ">
            </form>
          {% endif %}
        </td>
        <td></td>
      {% endif %}
    </tr>
    <tr>
      <td colspan=4 id=spacer></td>
    </tr>
    <tr>
      <td>4a. Kjøreplan: Opprett (<a href=/raceplans?event_id={{ event_id }}>se/endre</a>)</td>
      {% if (task_status.done_6) %}
        <td id=green>Utført</td>
        <td>
          <ul>
            <li class=dropdown>
              <a href= target="_blank" onclick="result_gui_href('myPPlan', 'print_lists?event_id={{ event_id }}&action=raceplan')" id="myPPlan" class=dropbtn>Skriv ut kjøreplan</a>
            </li>
          </ul>
        </td>
        <td>{{ task_status.no_of_races}} heat er opprettet.</td>
      {% else %}
        <td id=red>Mangler</td>
        <td>
          {% if (task_status.done_4) %}
            <form action=/raceplans method=post>
              <input type="hidden" name="event_id" value="{{ event_id }}">
              <input type="submit" name="generate_raceplan" value="  Generer kjøreplan  ">
            </form>
          {% endif %}
        </td>
        <td></td>
      {% endif %}
    </tr>
    <tr>
      <td colspan=4 id=spacer></td>
    </tr>
    <tr>
      <td>4b. Kjøreplan: Tilpass tidsskjema (<a href=/raceplans?event_id={{ event_id }}&action=edit_time>se/endre</a>)</td>
      <td>Manuell sjekk</td>
      <td>
        {% if (task_status.done_6) %}
          <form action=/raceplans method=get>
            <input type="hidden" name="event_id" value="{{ event_id }}">
            <input type="hidden" name=action value="edit_time">
            <input type="submit" name="edit_time" value="  Rediger starttid  ">
          </form>
        {% endif %}
      </td>
      <td></td>
  </tr>
  <tr>
    <td colspan=4 id=spacer></td>
  </tr>
  <tr>
    <td>5a. Deltakere: Startnummer (<a href=/contestants?event_id={{ event_id }}&action=edit_mode>se/endre</a>)</td>
    {% if (task_status.done_5) %}
      <td id=green>Utført</td>
      <td>
        <ul>
          <li class=dropdown>
            <a href=javascript:void(0) class=dropbtn>Skriv ut deltakerlister</a>
            <div class=dropdown-content>
              <a target=_blank href=print_contestants?event_id={{ event_id }}>Pr klasse</a>
              <a target=_blank href=print_contestants?event_id={{ event_id }}&action=klubb>Pr klubb</a>
              <a target=_blank href=print_contestants?event_id={{ event_id }}&action=alfabetisk_fornavn>Sortert på fornavn</a>
              <a target=_blank href=print_contestants?event_id={{ event_id }}&action=alfabetisk_etternavn>Sortert på etternavn</a>
            </div>
          </li>
        </ul>
      </td>
      <td>{{ task_status.bib_missing}} deltakere mangler startnummer.</td>
    {% else %}
        {% if (task_status.no_of_contestants == task_status.bib_missing) %}
          <td id=red>Mangler</td>
          <td>
            {% if (task_status.done_2) %}
              <form action=/contestants method=post>
                <input type="hidden" name=event_id value="{{ event_id }}">
                <input type="submit" name=assign_bibs value="  Tildel startnummer  ">
              </form>
            {% endif %}
          </td>
          <td></td>
        {% else %}
          <td id=orange>Delvis</td>
          <td></td>
          <td>{{ task_status.bib_missing}} deltakere mangler startnummer. </td>
        {% endif %}
      {% endif %}
    </tr>
    <tr>
      <td colspan=4 id=spacer></td>
    </tr>
    <tr>
      <td>5b. Deltakere: Seeding</td>
        <td>Manuell sjekk</td>
        <td>
          <form action=/contestants method=get>
            <input type="hidden" name=event_id value="{{ event_id }}">
            <input type="hidden" name=action value="seeding">
            <input type="submit" name=seeding value="  Utfør seeding  ">
          </form>
        </td>
        <td></td>
    </tr>
    <tr>
      <td colspan=4 id=spacer></td>
    </tr>
  <tr>
    <td>6a. Startliste: Opprett (<a id="mySeeStart" onclick="event_gui_href('mySeeStart', 'start_edit?event_id={{ event_id }}')" href=>se/endre</a>)</td>
    {% if (task_status.done_8) %}
      <td id=green>Utført</td>
      <td>
        <ul>
          <li class=dropdown>
            <a href= target="_blank" onclick="result_gui_href('myPStart', 'print_lists?event_id={{ event_id }}&action=start')" id="myPStart" class=dropbtn>Skriv ut startlister</a>
          </li>
        </ul>
      </td>
      <td> {{ task_status.no_of_starts }} starter er opprettet.</td>
    {% else %}
      <td id=red>Mangler</td>
      <td>
        {% if (task_status.done_6) %}
          <form action=/tasks method=post>
            <input type="hidden" name="event_id" value="{{ event_id }}">
            <input type="submit" name="generate_startlist" value="  Generer startliste  ">
          </form>
        {% endif %}
      </td>
      <td></td>
    {% endif %}
  </tr>
  <tr>
    <td colspan=4 id=spacer></td>
  </tr>
  <tr>
    <td>6b. "Videre til" oppsett: Opprett (<a id="mySeeControl" onclick="event_gui_href('mySeeControl', 'control?event_id={{ event_id }}&action=Template')" href=>se/endre</a>)</td>
    {% if (task_status.done_9) %}
      <td id=green>Utført</td>
      <td>
        {% if (task_status.done_6) %}
          <form action=/tasks method=post>
            <input type="hidden" name="event_id" value="{{ event_id }}">
            <input type="submit" name="generate_next_race" value="  Generer på nytt  ">
          </form>
        {% endif %}
      </td>
      <td>
        {{ task_status.no_of_next_race }} <i>videre til</i> semi og finaler er opprettet.
      </td>
    {% else %}
      <td id=red>Mangler</td>
      <td>
        {% if (task_status.done_6) %}
          <form action=/tasks method=post>
            <input type="hidden" name="event_id" value="{{ event_id }}">
            <input type="submit" name="generate_next_race" value="  Generer videre til oppsett  ">
          </form>
        {% endif %}
      </td>
      <td></td>
    {% endif %}
  </tr>
  <tr>
    <td colspan=4 id=spacer></td>
  </tr>
  <tr>
    <td>7. Opprydding</td>
      <td>Manuell operasjon</td>
      <td>
          <form action=/tasks method=post onsubmit="return confirm_delete();">
            <input type="hidden" name="event_id" value="{{ event_id }}">
            <input type="submit" name="delete_start_lists" value="  Slett alle startlister  ">
          </form>
          <div id=minispacer></div>
          <form action=/tasks method=post onsubmit="return confirm_delete();">
            <input type="hidden" name="event_id" value="{{ event_id }}">
            <input type="submit" name="delete_time_events" value="  Slett alle passeringer  ">
          </form>
      </td>
      <td>Mulighet til å slette alle startlister og passeringer, inkludert videre til oppsett.
      </td>
  </tr>
  <tr>
    <td>8. Eksporter data</td>
      <td>Manuell operasjon</td>
      <td>
        <ul>
          <li class=dropdown>
            <a href=javascript:void(0) class=dropbtn>CSV filer</a>
            <div class=dropdown-content>
              <a target=_blank href=/csv?event_id={{ event_id }}&action=contestants>Deltakere</a>
              <a target=_blank href=/csv?event_id={{ event_id }}&action=raceplan>Kjøreplan</a>
              <a target=_blank href=/csv?event_id={{ event_id }}&action=startlist>Startlister</a>
            </div>
          </li>
        </ul>
      </td>
      <td>Mulighet til å eksportere lister på csv format.
      </td>
  </tr>
  </table>
{% endblock %}
